<script>

// Load index.json first
fetch("data/index.json")
.then(response => response.json())
.then(config => {

    // Sort files descending (latest first)
    const priceFiles = config.price_files.sort().reverse();
    const latestPrice = priceFiles[0];

    // Load latest price CSV
    d3.csv("data/prices/" + latestPrice).then(function(data) {

        const timestamps = data.map(d => d.snapshot);
        const columns = Object.keys(data[0]);

        const provinces = columns.filter(c =>
            c !== "snapshot" && !c.includes("__")
        );

        const traces = provinces.map(zone => ({
            x: timestamps,
            y: data.map(d => +d[zone]),
            mode: "lines",
            name: zone
        }));

        Plotly.newPlot("priceChart", traces, {
            title: latestPrice,
            xaxis: { title: "Time" },
            yaxis: { title: "Price (â‚¬/MWh)" }
        });

    });

    // Load SOC file
    d3.csv("data/" + config.soc_file).then(function(data) {

        const names = data.map(d => d.name);
        const values = data.map(d => +Object.values(d)[1]);

        Plotly.newPlot("socChart", [{
            x: names,
            y: values,
            type: "bar"
        }], {
            xaxis: { title: "Storage Unit" },
            yaxis: { title: "Final SOC (MWh)" }
        });

    });

});

</script>